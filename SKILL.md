---
name: chart-data-extractor
description: 从各类图表图像中精确提取数据并输出为结构化格式。支持柱状图、条形图、折线图、曲线图、饼图、环形图、散点图、气泡图等。当用户提供图表图片并要求更改新样式、提取数据、读取数值、转换图表内容为表格或结构化数据时使用此skill。严格遵循原图表数据,确保精确数值提取,不进行估算或猜测。**重要限制：必须严格按照参考图的图表类型，不得改变图表类型（如柱状图不能改为折线图），必须在输出中明确标识图表类型并传递给chart-regenerator。**。
---

# Chart Data Extractor

## Overview

从图表图像中精确提取数据,保持原始数据的准确性和完整性,输出为Markdown表格格式。

**核心原则**：
- ⚠️ **保持图表类型**：必须严格保持原始图表类型，不能改变图表形式
- 📊 **类型标识**：必须在输出中明确标识图表类型，供chart-regenerator使用
- 🔢 **数据精确**：确保数值提取的准确性和完整性

## Quick Start

当用户提供图表图像时:

1. **使用图像分析工具**识别图表类型和关键元素(坐标轴、图例、标签等)
2. **参考详细指南**读取[Chart Extraction Guide](references/chart-extraction-guide.md)中对应图表类型的提取方法
3. **精确读取数据**根据图表类型执行相应的数据提取流程
4. **输出Markdown表格**将提取的数据组织为结构化的Markdown表格格式

## Supported Chart Types

此skill支持以下图表类型的数据提取:

### 柱状图/条形图 (Bar/Column Charts)
- 垂直或水平柱状图
- 分组柱状图(多系列)
- 堆叠柱状图

### 折线图/曲线图 (Line Charts)
- 单系列或多系列折线图
- 带数据点标记的折线图
- 面积图

### 饼图/环形图 (Pie/Donut Charts)
- 标准饼图
- 环形图
- 带百分比或数值标签

### 散点图/气泡图 (Scatter/Bubble Plots)
- 二维散点图
- 带颜色编码的散点图
- 气泡图(大小编码)

## Workflow

### Step 1: 图像分析

使用图像分析工具(如`mcp__4_5v_mcp__analyze_image`)分析提供的图表图像:

```
识别内容:
- ⚠️ 图表类型（最重要）：必须准确识别并记录图表类型
  * 是柱状图还是折线图？
  * 是饼图还是环形图？
  * 是散点图还是气泡图？
  * 这决定了后续重新生成时的形式
- 标题、轴标签、刻度
- 图例和数据系列
- 数据标签和注释
- 特殊元素(网格线、趋势线等)
```

**重要提醒**：图表类型的识别是第一步的核心任务，必须100%准确。

### Step 2: 确定提取策略

根据图表类型,从[Chart Extraction Guide](references/chart-extraction-guide.md)中获取详细的提取方法:

- 柱状图提取方法 → `references/chart-extraction-guide.md#柱状图`
- 折线图提取方法 → `references/chart-extraction-guide.md#折线图`
- 饼图提取方法 → `references/chart-extraction-guide.md#饼图`
- 散点图提取方法 → `references/chart-extraction-guide.md#散点图`

### Step 3: 数据提取

按照详细指南中的步骤进行数据提取:

**核心原则:**
- **精确性优先**: 优先使用图表上的数据标签,其次根据坐标轴刻度精确读取
- **完整性**: 提取所有可见数据点,不遗漏任何系列
- **验证性**: 在输出前验证数据的合理性(如饼图百分比总和为100%)

### Step 4: 输出结构化数据

将提取的数据组织为Markdown表格格式,包含:

- ⚠️ **图表类型**（必须）：明确标识图表类型，供chart-regenerator使用
- 清晰的表格标题
- 列标题(包括单位说明)
- 所有数据点
- 必要的备注说明(单位、精度、特殊情况等)

**输出模板:**

```markdown
## [图表标题]

**⚠️ 图表类型:** [具体类型，如"分组柱状图"、"折线图"、"饼图"等] - 必须明确标识
**说明:** [图表元素的简要说明]

| [列1] | [列2] | [列3] |
|-------|-------|-------|
| [数据] | [数据] | [数据] |

**备注:**
- 单位: [单位说明]
- 精度: [精度说明]
- ⚠️ 图表类型识别: [图表类型说明，必须保持不变]
- 其他注意事项: [其他说明]
```

**重要**：`图表类型`字段是必须的，将直接影响chart-regenerator的生成方式。

## Quality Standards

### 精确性要求

1. **数值读取**: 必须精确读取,不允许估算或猜测
2. **标签完整**: 保持原始标签格式,不简化或改写
3. **小数精度**: 保持图表中显示的小数位数
4. **单位准确**: 正确记录和应用单位

### 验证检查

输出前必须验证:
- [ ] 数据点数量与图表显示一致
- [ ] 数值总和合理(饼图百分比≈100%)
- [ ] 所有系列都已提取
- [ ] 图例正确应用到数据系列
- [ ] 时间序列保持原始格式
- [ ] ⚠️ **图表类型准确识别**（最重要）：确保图表类型100%正确，不混淆类型
- [ ] ⚠️ **图表类型明确标识**：在输出中明确写出图表类型名称

### 错误处理

如果遇到以下情况,在输出中明确说明:

- 数据点模糊不清无法读取
- 坐标轴刻度不完整
- 图表有缺失或损坏部分
- 单位或标注不明确

## Examples

### Example 1: 柱状图提取

**用户请求**: "提取这个柱状图的数据"

**提取流程**:
1. 分析图像识别为分组柱状图,包含3个系列
2. 读取Y轴刻度范围(0-100)和X轴类别标签
3. 逐个读取每个柱子的数值(优先使用数据标签)
4. 输出为3列数据表格

**输出格式**:
```markdown
## 季度销售数据

**⚠️ 图表类型:** 分组柱状图 - 必须保持为柱状图，不得改为折线图或其他类型
**说明:** 3个产品在4个季度的销售对比

| 季度 | 产品A | 产品B | 产品C |
|------|-------|-------|-------|
| Q1   | 45    | 32    | 58    |
| Q2   | 52    | 41    | 63    |

**备注:**
- ⚠️ 图表类型: 分组柱状图（垂直）
- 单位: 万元
```

### Example 2: 饼图提取

**用户请求**: "把这个饼图的数据提取成表格"

**提取流程**:
1. 分析图像识别为标准饼图,包含5个扇区
2. 读取每个扇区的百分比标签
3. 从图例中获取对应的类别名称
4. 验证百分比总和为100%
5. 输出为类别-百分比对照表

**输出格式**:
```markdown
## 市场份额分布

**⚠️ 图表类型:** 标准饼图 - 必须保持为饼图，不得改为环形图或其他类型
**说明:** 5个产品的市场份额占比

| 类别   | 百分比 |
|--------|--------|
| 产品A  | 35%    |
| 产品B  | 25%    |
| 产品C  | 20%    |
| 产品D  | 15%    |
| 其他   | 5%     |

**备注:**
- ⚠️ 图表类型: 标准饼图（5个扇区）
- 百分比总和: 100%
```

## Resources

### references/chart-extraction-guide.md

详细的图表数据提取指南,包含:

- **通用流程**: 4步数据提取法(识别→定位→读取→验证)
- **图表类型详细方法**: 每种图表类型的具体提取步骤和技巧
- **特殊情况处理**: 对数坐标、双Y轴、时间轴等特殊情况
- **精度控制规范**: 数值读取规则、舍入处理、误差控制
- **质量检查清单**: 完整的验证步骤
- **常见错误避免**: 提高准确性的注意事项

当需要特定图表类型的详细提取方法时,读取此参考文档。

## Important Notes

1. **严格遵循原始数据**: 提取的数据必须与图表完全一致,不进行任何形式的估算、插值或推测
2. **严格保持图表类型** ⚠️ **最重要**：
   - 识别为柱状图 → 必须传递为柱状图，不能改为折线图或其他
   - 识别为折线图 → 必须传递为折线图，不能改为柱状图或其他
   - 识别为饼图 → 必须传递为饼图，不能改为环形图或其他
   - **任何图表类型的改变都是严重错误**
3. **明确标识图表类型**：必须在输出中使用`**图表类型:**`字段明确标识
4. **类型传递给chart-regenerator**：图表类型信息将直接传递给chart-regenerator，确保重新生成时保持相同类型
5. **优先级规则**: 数据标签 > 坐标轴读取 > 网格线辅助
6. **保持原格式**: 日期、百分比、科学计数法等保持图表原始格式
7. **完整性优先**: 如果图表显示N个数据点,必须提取全部N个,不能遗漏
8. **验证是必需的**: 输出前必须进行合理性检查,确保数据准确和图表类型正确
