# chart-data-extractor Skill 修改总结

## 修改日期
2026-01-13

## 修改目的
在chart-data-extractor skill中添加图表类型保持限制，确保：
1. 严格按照参考图的图表类型
2. 不能改变图表类型（如柱状图不能改为折线图）
3. 必须明确把图表类型传递给chart-regenerator

---

## 📝 修改内容

### 1. 修改 description（第3行）

**修改前**：
```yaml
description: 从各类图表图像中精确提取数据并输出为结构化格式...严格遵循原图表数据,确保精确数值提取,不进行估算或猜测
```

**修改后**：
```yaml
description: 从各类图表图像中精确提取数据并输出为结构化格式...严格遵循原图表数据,确保精确数值提取,不进行估算或猜测。**重要限制：必须严格按照参考图的图表类型，不得改变图表类型（如柱状图不能改为折线图），必须在输出中明确标识图表类型并传递给chart-regenerator。**
```

---

### 2. 添加核心原则（Overview部分）

**新增内容**：
```markdown
**核心原则**：
- ⚠️ **保持图表类型**：必须严格保持原始图表类型，不能改变图表形式
- 📊 **类型标识**：必须在输出中明确标识图表类型，供chart-regenerator使用
- 🔢 **数据精确**：确保数值提取的准确性和完整性
```

---

### 3. 强化 Step 1: 图像分析

**修改前**：
```markdown
识别内容:
- 图表类型和整体布局
- 标题、轴标签、刻度
...
```

**修改后**：
```markdown
识别内容:
- ⚠️ 图表类型（最重要）：必须准确识别并记录图表类型
  * 是柱状图还是折线图？
  * 是饼图还是环形图？
  * 是散点图还是气泡图？
  * 这决定了后续重新生成时的形式
- 标题、轴标签、刻度
...

**重要提醒**：图表类型的识别是第一步的核心任务，必须100%准确。
```

---

### 4. 强化 Step 4: 输出结构化数据

**修改前**：
```markdown
将提取的数据组织为Markdown表格格式,包含:
- 清晰的表格标题
- 列标题(包括单位说明)
- 所有数据点
- 必要的备注说明(单位、精度、特殊情况等)
```

**修改后**：
```markdown
将提取的数据组织为Markdown表格格式,包含:
- ⚠️ **图表类型**（必须）：明确标识图表类型，供chart-regenerator使用
- 清晰的表格标题
- 列标题(包括单位说明)
- 所有数据点
- 必要的备注说明(单位、精度、特殊情况等)
```

**输出模板更新**：
```markdown
## [图表标题]

**⚠️ 图表类型:** [具体类型，如"分组柱状图"、"折线图"、"饼图"等] - 必须明确标识
**说明:** [图表元素的简要说明]

| [列1] | [列2] | [列3] |
|-------|-------|-------|
| [数据] | [数据] | [数据] |

**备注:**
- 单位: [单位说明]
- 精度: [精度说明]
- ⚠️ 图表类型识别: [图表类型说明，必须保持不变]
- 其他注意事项: [其他说明]
```

**新增说明**：
```markdown
**重要**：`图表类型`字段是必须的，将直接影响chart-regenerator的生成方式。
```

---

### 5. 更新验证检查

**新增验证项**：
```markdown
- [ ] ⚠️ **图表类型准确识别**（最重要）：确保图表类型100%正确，不混淆类型
- [ ] ⚠️ **图表类型明确标识**：在输出中明确写出图表类型名称
```

---

### 6. 强化 Important Notes

**新增最重要的限制**：
```markdown
2. **严格保持图表类型** ⚠️ **最重要**：
   - 识别为柱状图 → 必须传递为柱状图，不能改为折线图或其他
   - 识别为折线图 → 必须传递为折线图，不能改为柱状图或其他
   - 识别为饼图 → 必须传递为饼图，不能改为环形图或其他
   - **任何图表类型的改变都是严重错误**
3. **明确标识图表类型**：必须在输出中使用`**图表类型:**`字段明确标识
4. **类型传递给chart-regenerator**：图表类型信息将直接传递给chart-regenerator，确保重新生成时保持相同类型
```

---

### 7. 更新示例

**所有示例都添加了图表类型字段**：

**Example 1 - 柱状图**：
```markdown
**⚠️ 图表类型:** 分组柱状图 - 必须保持为柱状图，不得改为折线图或其他类型
```

**Example 2 - 饼图**：
```markdown
**⚠️ 图表类型:** 标准饼图 - 必须保持为饼图，不得改为环形图或其他类型
```

---

## 📁 新增文件

### examples/chart_type_transfer.md

创建了一个详细的示例文档，展示：
1. 如何正确识别图表类型
2. 如何在输出中明确标识图表类型
3. 如何将图表类型传递给chart-regenerator
4. 错误示例和正确示例对比
5. 图表类型映射表
6. 验证清单

---

## 🎯 核心变更

### 变更1：添加图表类型保持限制

**原则**：
```
识别为柱状图 → 必须生成柱状图
识别为折线图 → 必须生成折线图
识别为饼图 → 必须生成饼图
```

**禁止**：
```
❌ 柱状图 → 折线图
❌ 折线图 → 柱状图
❌ 饼图 → 环形图
❌ 任何图表类型的改变
```

### 变更2：强制图表类型标识

**要求**：
```markdown
**⚠️ 图表类型:** [具体类型] - 必须明确标识
```

**位置**：
- 在输出标题下方第一行
- 使用`**图表类型:**`格式
- 明确说明类型特征（如"垂直"、"分组"等）

### 变更3：类型传递机制

```
chart-data-extractor → 识别类型 → 输出包含类型字段
                                ↓
chart-regenerator ← 读取类型 ← 按类型生成图表
```

---

## 📊 影响范围

### 对chart-data-extractor的影响

✅ **必须做的**：
1. 在Step 1中准确识别图表类型
2. 在输出中使用`**图表类型:**`字段
3. 验证图表类型的准确性
4. 在Important Notes中强调类型保持

❌ **不能做的**：
1. 不能混淆图表类型（如饼图vs环形图）
2. 不能省略图表类型字段
3. 不能改变图表类型
4. 不能在输出中不明确类型

### 对chart-regenerator的影响

✅ **必须做的**：
1. 读取chart-data-extractor输出的图表类型
2. 按照指定类型生成图表
3. 验证生成的图表类型与指定类型一致
4. 在生成前确认类型信息

❌ **不能做的**：
1. 不能忽略图表类型信息
2. 不能生成与指定类型不同的图表
3. 不能自动改变图表类型
4. 不能在类型不匹配时继续生成

---

## ✅ 验证清单

使用前必须验证：

### chart-data-extractor
- [ ] 已准确识别图表类型
- [ ] 图表类型在输出中明确标识
- [ ] 类型信息使用`**图表类型:**`格式
- [ ] 类型描述准确（如"分组柱状图（垂直）"）
- [ ] 在备注中再次强调类型

### chart-regenerator
- [ ] 已读取图表类型信息
- [ ] 将按照指定类型生成图表
- [ ] 生成前验证类型一致性
- [ ] 类型不匹配时报错或询问

---

## 🔗 工作流程示例

### 正确的完整流程

```
用户提供柱状图
    ↓
[chart-data-extractor]
1. 识别为"分组柱状图（垂直）"
2. 提取数据
3. 输出：
   **⚠️ 图表类型:** 分组柱状图 - 必须保持为柱状图
   | 季度 | 产品A |
   |------|-------|
   | Q1   | 45    |
    ↓
传递类型信息
    ↓
[chart-regenerator]
1. 读取类型："分组柱状图"
2. 验证：是柱状图
3. 生成柱状图（扁平风格，黑白灰）
    ↓
结果：柱状图（新样式，相同类型）
```

### 错误的流程示例

```
用户提供柱状图
    ↓
[chart-data-extractor] ❌ 错误
1. 识别为"分组柱状图"
2. 输出：
   **图表类型:** 分组柱状图
   ...（数据）
    ↓
传递类型信息
    ↓
[chart-regenerator] ❌ 错误
1. 忽略类型信息
2. 生成折线图 ❌ 错误！
    ↓
结果：折线图（类型错误）
```

---

## 📚 相关文档

1. **SKILL.md** - 已更新，包含所有限制和说明
2. **examples/chart_type_transfer.md** - 新增，详细的类型传递示例
3. **chart-regenerator/SKILL.md** - 需要同步更新，说明如何接收和使用图表类型信息

---

## 🎯 总结

### 核心原则

**⚠️ 保持图表类型不变**

无论样式如何改变，图表的类型必须保持一致：
- 柱状图永远生成柱状图
- 折线图永远生成折线图
- 饼图永远生成饼图

### 实现方式

1. **chart-data-extractor**：
   - 识别类型
   - 标识类型
   - 传递类型

2. **chart-regenerator**：
   - 读取类型
   - 验证类型
   - 按类型生成

### 目标

确保用户在"改样式"时，图表的表达形式（类型）保持不变，只改变视觉风格。

---

## 📞 支持

如有疑问，请参考：
- SKILL.md（完整规范）
- examples/chart_type_transfer.md（详细示例）
- 与chart-regenerator的集成文档

---

**版本**: v1.1.0
**更新日期**: 2026-01-13
**维护者**: Chart Data Extractor Team
