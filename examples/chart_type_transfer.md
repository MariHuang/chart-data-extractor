# Chart Data Extractor - 图表类型传递示例

## 概述

本文档展示chart-data-extractor如何识别图表类型并将其传递给chart-regenerator，确保图表类型保持不变。

## 工作流程

```
原始图表
    ↓
[chart-data-extractor]
- 识别图表类型 ⚠️ 最重要
- 提取数据
- 输出结构化数据（包含图表类型字段）
    ↓
传递给 [chart-regenerator]
- 读取图表类型
- 保持相同类型重新生成
    ↓
新样式图表（相同类型）
```

## 示例1：柱状图

### 原始图表
假设用户提供了一张分组柱状图，展示3个产品在4个季度的销售数据。

### chart-data-extractor输出

```markdown
## 季度销售数据

**⚠️ 图表类型:** 分组柱状图（垂直） - 必须保持为柱状图，不得改为折线图
**说明:** 3个产品在4个季度的销售对比

| 季度 | 产品A | 产品B | 产品C |
|------|-------|-------|-------|
| Q1   | 45    | 32    | 58    |
| Q2   | 52    | 41    | 63    |
| Q3   | 48    | 38    | 60    |
| Q4   | 60    | 45    | 70    |

**备注:**
- ⚠️ 图表类型: 分组柱状图（垂直）
- Y轴: 销售额（万元）
- X轴: 季度
- 单位: 万元
```

### 传递给chart-regenerator

```python
# chart-regenerator读取图表类型
chart_type = "分组柱状图（垂直）"  # 从输出中提取

# 确保生成相同类型
if chart_type.startswith("柱状图"):
    # 生成柱状图，不生成折线图
    generate_bar_chart(data)
else:
    raise ValueError(f"图表类型不匹配：要求{chart_type}，但试图生成其他类型")
```

### 结果

chart-regenerator生成**柱状图**，不会生成折线图或饼图。

## 示例2：折线图

### 原始图表
假设用户提供了一张多系列折线图，展示2020-2024年的趋势。

### chart-data-extractor输出

```markdown
## 年度增长趋势

**⚠️ 图表类型:** 多系列折线图 - 必须保持为折线图，不得改为柱状图
**说明:** 3个系列在5年间的增长趋势

| 年份 | 系列A | 系列B | 系列C |
|------|-------|-------|-------|
| 2020 | 20    | 15    | 10    |
| 2021 | 35    | 28    | 18    |
| 2022 | 45    | 38    | 25    |
| 2023 | 60    | 52    | 35    |
| 2024 | 75    | 68    | 48    |

**备注:**
- ⚠️ 图表类型: 多系列折线图（带数据点标记）
- Y轴: 增长率（%）
- X轴: 年份
```

### 传递给chart-regenerator

```python
chart_type = "多系列折线图"

# 确保生成折线图
if chart_type.startswith("折线图"):
    generate_line_chart(data)  # 生成折线图
else:
    raise ValueError(f"图表类型不匹配")
```

### 结果

chart-regenerator生成**折线图**，不会生成柱状图或其他类型。

## 示例3：饼图

### 原始图表
假设用户提供了一张标准饼图，展示市场份额。

### chart-data-extractor输出

```markdown
## 市场份额分布

**⚠️ 图表类型:** 标准饼图 - 必须保持为饼图，不得改为环形图或柱状图
**说明:** 5个产品的市场份额占比

| 类别   | 百分比 |
|--------|--------|
| 产品A  | 35%    |
| 产品B  | 25%    |
| 产品C  | 20%    |
| 产品D  | 15%    |
| 其他   | 5%     |

**备注:**
- ⚠️ 图表类型: 标准饼图（5个扇区）
- 百分比总和: 100%
```

### 传递给chart-regenerator

```python
chart_type = "标准饼图"

if chart_type.startswith("饼图"):
    generate_pie_chart(data)  # 生成饼图
elif chart_type.startswith("环形图"):
    generate_donut_chart(data)  # 生成环形图
else:
    raise ValueError(f"图表类型不匹配")
```

### 结果

chart-regenerator生成**饼图**，不会生成环形图或柱状图。

## 错误示例 ⚠️

### 错误1：改变图表类型

❌ **错误做法**：
```markdown
**图表类型:** 分组柱状图

# chart-regenerator错误地生成了折线图
```

❌ **后果**：
- 违反了chart-data-extractor的限制
- 用户期望得到柱状图，但收到了折线图
- 数据表达方式发生改变

### 错误2：图表类型标识不明确

❌ **错误做法**：
```markdown
**说明:** 这是一个柱状图
# 缺少明确的"图表类型:"字段
```

❌ **后果**：
- chart-regenerator无法识别图表类型
- 可能生成错误的图表类型
- 违反了skill的限制

### 错误3：混淆相似图表类型

❌ **错误做法**：
```markdown
**图表类型:** 环形图

# 实际上是饼图，但错误识别为环形图
# chart-regenerator生成了环形图
```

❌ **后果**：
- 图表类型识别不准确
- 虽然相似，但不是原始类型
- 可能影响数据的表达方式

## 正确做法 ✅

### 正确1：准确识别并明确标识

✅ **正确做法**：
```markdown
**⚠️ 图表类型:** 分组柱状图（垂直） - 必须保持为柱状图
**说明:** 3个产品的销售对比

| 季度 | 产品A | 产品B | 产品C |
|------|-------|-------|-------|
| Q1   | 45    | 32    | 58    |

**备注:**
- ⚠️ 图表类型: 分组柱状图（垂直）
```

✅ **结果**：
- 图表类型准确识别
- chart-regenerator生成正确的柱状图
- 保持原始表达方式

### 正确2：传递类型信息

✅ **正确做法**：
```python
# chart-data-extractor输出
chart_type = "分组柱状图（垂直）"

# 传递给chart-regenerator
data_with_type = {
    'chart_type': chart_type,  # 明确传递
    'data': {...}
}

# chart-regenerator读取
if data_with_type['chart_type'].startswith("柱状图"):
    generate_bar_chart(data_with_type['data'])
```

✅ **结果**：
- 类型信息准确传递
- chart-regenerator按照指定类型生成
- 保证类型一致性

## 图表类型映射表

| 原始图表类型 | chart-data-extractor标识 | chart-regenerator生成 | 是否允许改变 |
|-------------|-------------------------|---------------------|------------|
| 柱状图（垂直） | 柱状图（垂直） | 柱状图（垂直） | ❌ 否 |
| 柱状图（水平） | 柱状图（水平） | 柱状图（水平） | ❌ 否 |
| 分组柱状图 | 分组柱状图 | 分组柱状图 | ❌ 否 |
| 堆叠柱状图 | 堆叠柱状图 | 堆叠柱状图 | ❌ 否 |
| 折线图 | 折线图 | 折线图 | ❌ 否 |
| 平滑曲线图 | 平滑曲线图 | 平滑曲线图 | ❌ 否 |
| 饼图 | 饼图 | 饼图 | ❌ 否 |
| 环形图 | 环形图 | 环形图 | ❌ 否 |
| 散点图 | 散点图 | 散点图 | ❌ 否 |
| 气泡图 | 气泡图 | 气泡图 | ❌ 否 |

## 验证清单

在传递数据给chart-regenerator之前，必须验证：

- [ ] 图表类型已准确识别
- [ ] 图表类型已在输出中明确标识（使用`**图表类型:**`）
- [ ] 图表类型符合原始图表（如：柱状图不是折线图）
- [ ] 图表类型信息将传递给chart-regenerator
- [ ] chart-regenerator将按照指定类型生成

## 总结

1. **chart-data-extractor的任务**：
   - 识别图表类型（最重要）
   - 在输出中明确标识图表类型
   - 确保类型信息可被chart-regenerator读取

2. **chart-regenerator的任务**：
   - 读取图表类型信息
   - 按照指定类型生成图表
   - 不改变图表类型

3. **核心原则**：
   - ⚠️ 保持图表类型不变
   - ⚠️ 明确标识图表类型
   - ⚠️ 准确传递图表类型

这确保了用户在重新生成图表时，图表的类型保持一致，只改变样式。
