# 图表数据提取指南

本文档提供从各类图表中精确提取数据的详细指南。

## 核心原则

1. **精确性优先**: 所有数据必须从图表中精确读取,不允许估算或猜测
2. **完整性**: 提取所有可见的数据点,包括标签、数值、图例等
3. **可验证性**: 提供足够的信息使得提取的数据可以被验证
4. **结构化输出**: 将提取的数据组织为Markdown表格格式

## 通用数据提取流程

### 第一步: 图表识别

使用图像分析工具识别图表的基本信息:
- 图表类型(柱状图、折线图、饼图、散点图等)
- 坐标轴信息(X轴、Y轴的标签和刻度)
- 图例说明
- 数据系列数量
- 标题和副标题

### 第二步: 数据点定位

对于每个数据点:
1. 确定其在图表中的位置
2. 读取对应的坐标值或标签
3. 记录数据系列归属(如果有多个系列)
4. 注意任何特殊标记(如数据标签、注释等)

### 第三步: 数值精确读取

**对于带坐标轴的图表(柱状图、折线图、散点图):**
- 读取Y轴刻度,确定数值范围和间隔
- 读取X轴刻度或标签
- 对于每个数据点,精确读取其Y轴数值
- 如果有网格线,利用网格线辅助读取
- 如果有数据标签,优先使用标签上的数值

**对于饼图:**
- 读取每个扇区的百分比标签
- 如果没有百分比,使用角度计算(360度 × 扇区角度占比)
- 读取图例,确认每个扇区对应的类别
- 注意是否显示绝对数值

### 第四步: 数据验证

在输出前验证:
- 数值总和是否合理(饼图百分比应为100%)
- 数据点数量是否与图表中显示的一致
- 是否有遗漏的数据系列或数据点
- 标签和分类是否准确

## 各类图表的具体提取方法

### 柱状图 (Bar/Column Charts)

**识别特征:**
- 垂直或水平的矩形条
- 每个条代表一个数据点
- 可能有分组(并排)或堆叠形式

**提取步骤:**
1. 识别Y轴(垂直柱状图)或X轴(水平柱状图)的刻度和标签
2. 确定每个柱子对应的X轴(或Y轴)类别
3. 精确读取每个柱子的高度对应的数值:
   - 如果柱子顶部有数值标签,直接使用
   - 如果没有,根据Y轴刻度和柱子高度读取
   - 对于分组柱状图,区分不同的系列(颜色或图例)
   - 对于堆叠柱状图,读取每段的数值或整体高度
4. 记录所有数据系列名称(从图例获取)

**输出格式:**
```
| 类别 | 系列1 | 系列2 | ... |
|------|-------|-------|-----|
| X1   | 值    | 值    | ... |
| X2   | 值    | 值    | ... |
```

### 折线图 (Line Charts)

**识别特征:**
- 用线段连接的数据点
- 可能有多个系列(多条线)
- 可能包含数据点标记(圆点、方块等)

**提取步骤:**
1. 识别X轴和Y轴的刻度和标签
2. 识别有多少条线(数据系列)
3. 对于每条线:
   - 读取系列名称(从图例)
   - 沿着线追踪所有可见的数据点
   - 精确读取每个数据点的(X, Y)坐标值
   - 如果有数据点标记,优先读取标记位置的数值
   - 注意缺失数据点(断点)
4. 记录所有X轴标签

**输出格式:**
```
| X轴 | 系列1 | 系列2 | ... |
|-----|-------|-------|-----|
| X1  | Y值   | Y值   | ... |
| X2  | Y值   | Y值   | ... |
```

### 饼图 (Pie Charts)

**识别特征:**
- 圆形图,分为多个扇形
- 每个扇区代表一个类别
- 通常显示百分比

**提取步骤:**
1. 识别图例,确定每个扇区对应的类别
2. 读取每个扇区的百分比标签:
   - 优先使用扇区内显示的百分比
   - 如果没有,根据扇区角度计算
3. 如果有显示绝对数值,同时记录
4. 验证所有百分比之和为100%(允许舍入误差±1%)
5. 注意是否有"其他"或"未分类"的扇区

**输出格式:**
```
| 类别   | 百分比 | 数值(如有) |
|--------|--------|------------|
| 类别1  | XX%    | 数值       |
| 类别2  | XX%    | 数值       |
```

### 散点图 (Scatter Plots)

**识别特征:**
- 用点表示数据,没有连线
- 通常显示两个变量的关系
- 可能有颜色或大小编码的第三个维度

**提取步骤:**
1. 识别X轴和Y轴的标签和刻度范围
2. 系统地扫描图表区域,定位所有数据点
3. 对于每个数据点:
   - 精确读取其(X, Y)坐标值
   - 如果有颜色编码,记录对应的系列或类别
   - 如果点的大小不同,记录大小数值(如有图例说明)
4. 统计数据点总数,确保没有遗漏
5. 如果有趋势线,同时读取趋势线方程或参数

**输出格式:**
```
| 数据点 | X值 | Y值 | 系列/类别(如有) |
|--------|-----|-----|-----------------|
| 1      | 值  | 值  | 类别            |
| 2      | 值  | 值  | 类别            |
```

## 特殊情况处理

### 对数坐标轴

如果坐标轴是对数刻度:
1. 识别对数基数(通常是10)
2. 根据对数刻度读取数值
3. 在输出中注明使用了对数坐标

### 双Y轴

对于有两个Y轴的图表:
1. 区分左Y轴和右Y轴
2. 确定每个数据系列对应哪个Y轴
3. 分别读取两个Y轴的刻度
4. 在表格中注明每个系列使用的Y轴

### 缩放或放大的图表

如果图表有缩放标注:
1. 读取缩放比例(如"100x", "×10^-3"等)
2. 在输出数值时考虑缩放因素
3. 在表格说明中注明缩放信息

### 时间轴

对于时间序列图表:
1. 准确读取日期/时间格式
2. 保持原始格式(如"2024-01", "Q1", "1月"等)
3. 注意时间间隔是否均匀
4. 识别是否有缺失的时间点

### 数据标签优先级

当图表中有多个数值来源时,按以下优先级:
1. **数据标签**: 图表上直接标注的数值(最优先)
2. **坐标轴读取**: 根据坐标轴刻度精确读取
3. **网格线辅助**: 利用网格线进行插值读取
4. **工具提示**: 如果有交互式工具提示的截图

## 精度控制

### 数值读取规则

1. **整数**: 按原样读取
2. **小数**: 保留原图中显示的小数位数
3. **科学计数法**: 保持原始格式(如"1.5E-5"）
4. **百分比**: 保留原始精度,如"25.5%"不转换为"0.255"
5. **千分位分隔符**: 移除逗号,如"1,234"记录为"1234"

### 舍入处理

- 当图表显示舍入后的数值时,保持图表的舍入方式
- 不对数值进行二次舍入
- 如果需要计算,使用精确值,最终结果再舍入

### 误差控制

- 提供的数据必须精确到图表显示的水平
- 如果数值无法精确确定,在备注中说明
- 对于模糊的数据点,标注"约"或提供范围

## 输出规范

### Markdown表格格式

提取的数据必须以Markdown表格形式输出,包含:

**基本要素:**
- 清晰的列标题
- 所有数据点
- 单位说明(在标题或注释中)
- 数据系列说明

**表格结构:**

```markdown
## 图表标题

**图表类型:** [类型]
**数据来源:** [图片来源说明]

| 列1 | 列2 | 列3 |
|-----|-----|-----|
| 数据 | 数据 | 数据 |
| 数据 | 数据 | 数据 |

**备注:**
- 任何特殊说明
- 数据精度说明
- 缺失数据说明
```

### 多表格情况

如果图表包含多个不同类型的数据:
- 为每个数据集创建单独的表格
- 使用清晰的标题区分
- 说明表格之间的关系

## 质量检查清单

在完成数据提取后,进行以下检查:

- [ ] 所有数据点都已提取
- [ ] 数值与图表显示一致
- [ ] 类别/标签完整且准确
- [ ] 图例信息已正确应用
- [ ] 表格格式正确
- [ ] 单位已说明
- [ ] 特殊情况已注明
- [ ] 数据总数与图表显示一致
- [ ] 饼图百分比总和为100%(±1%)
- [ ] 时间序列保持原始格式

## 常见错误避免

1. **数值读取错误**: 不要依赖目测估算,必须精确读取刻度
2. **系列混淆**: 使用颜色和图例仔细区分不同数据系列
3. **遗漏数据点**: 系统地扫描整个图表区域
4. **单位错误**: 注意坐标轴上的单位标注
5. **舍入偏差**: 保持图表原始精度,不要过度舍入
6. **标签错误**: 准确读取X轴类别标签,不要简化或改写
